# Docker Compose override for testing
# Use: docker-compose -f docker-compose.yml -f tests/docker-compose.test.yml up

services:
  nginx:
    volumes:
      # Override the default config with test configs dynamically
      - ./tests/configs:/etc/nginx/test-configs:ro
    environment:
      - TEST_MODE=true

  # Test runner service
  test-runner:
    build:
      context: tests/
      dockerfile: Dockerfile.test
    container_name: ngx-inference-test-runner
    depends_on:
      - nginx
      - echo-server
      - mock-epp
    volumes:
      - ./tests:/app/tests:ro
      - ./tests/docker-configs:/app/configs:ro
    environment:
      - NGINX_URL=http://nginx:80
    networks:
      - default
    profiles:
      - test