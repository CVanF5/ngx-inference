# Base configuration for local nginx testing
# This file provides the main context and includes test-specific server blocks
#
# Placeholders:
# - MODULE_PATH_PLACEHOLDER: Will be replaced with the appropriate module path
#   - Local development: ./target/debug/libngx_inference.so
#   - Docker/Production: /usr/lib/nginx/modules/libngx_inference.so
# - TEST_SERVER_CONFIG_PLACEHOLDER: Will be replaced with specific server config file
# - RESOLVER_PLACEHOLDER: Will be replaced with the system's first DNS resolver

load_module MODULE_PATH_PLACEHOLDER;

worker_processes auto;
error_log ERROR_LOG_PLACEHOLDER debug;
pid /tmp/nginx-ngx-inference.pid;

events {
    worker_connections 1024;
    multi_accept on;
}

http {
    include MIMETYPES_PATH_PLACEHOLDER;
    default_type application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log ACCESS_LOG_PLACEHOLDER main;
    error_log ERROR_LOG_PLACEHOLDER debug;

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    client_max_body_size 50m;
    client_body_buffer_size 16k;
    client_body_temp_path /tmp/nginx_client_body_temp;
    proxy_temp_path /tmp/nginx_proxy_temp;
    fastcgi_temp_path /tmp/nginx_fastcgi_temp;
    scgi_temp_path /tmp/nginx_scgi_temp;
    uwsgi_temp_path /tmp/nginx_uwsgi_temp;
    resolver RESOLVER_PLACEHOLDER valid=30s;

    # Include the test-specific server configuration
    include TEST_SERVER_CONFIG_PLACEHOLDER;
}
